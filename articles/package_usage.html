<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use hydramse • hydramse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use hydramse">
<meta property="og:description" content="hydramse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hydramse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/darwinData_explained.html">Lazy Data from Darwinian study</a>
    </li>
    <li>
      <a href="../articles/package_usage.html">How to use hydramse</a>
    </li>
    <li>
      <a href="../articles/simulation_documentation.html">Darwinian Process - simulation methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="package_usage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use hydramse</h1>
            
      
      
      <div class="hidden name"><code>package_usage.Rmd</code></div>

    </div>

    
    
<p>The functions in this package allow you to perform a sequence of events resulting in an MSE (Management Strategy Evaluation) type of workflow (Assumes package hydradata and hydra_sim (tpl file)). This is not a stand alone package and needs to be used in conjunction with the aforementioned packages</p>
<ol style="list-style-type: decimal">
<li>Simulate a set of parameters that are assumed somewhat unknown (assumes hydradata)</li>
<li>Assess the validity of this parameter set.</li>
<li>If assumed valid ,define a set of scenarios with ranges of exploitation rates (otherwise return to step 1)</li>
<li>Create dat and pin files for each scenario. These are input files for Hydra model (assumes hydradata)</li>
<li>Run Hydra a number of times (with stochasticity) (assumes hydra_sim)</li>
<li>Process the output and produce plots</li>
<li>Repeat until n valid sets of parameters have been obtained</li>
<li>Compare all output (NOT YET DONE)</li>
</ol>
<div id="model-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#model-setup" class="anchor"></a>Model Setup</h2>
<p>Decisions need to be made regarding how long to run the model for in the absence of fishing (the number of years). This decision is based on how long the model takes to reach some kind of equilibrium (if it does at all). An equilibrium may not be reached if a species stock recruitment relationship is highly overcompensatory. This may result in a highly cyclical behavior, possiblly around an average. It is recommended that the user specify the total length of the model run.</p>
<p>Once specified, the underlying data used to create Hydra’s data files (dat and pin) needs to be extended to accomodate these additional years of data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newData</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/lengthen_hydra_data.html">lengthen_hydra_data</a></span><span class="op">(</span><span class="fu">hydradata</span><span class="fu">::</span><span class="va">hydraDataList</span>,nYrs<span class="op">=</span><span class="fl">150</span><span class="op">)</span></code></pre></div>
<p>Set up the locations for output (create if necessary):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outDirForDatPin</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"darwin"</span><span class="op">)</span> <span class="co"># folder for dumping hydra output prior to analysis</span>
<span class="va">outPath</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"successfulSims"</span><span class="op">)</span> <span class="co"># folder containing parameters of successful model runs</span>

<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">outDirForDatPin</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">outDirForDatPin</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">outPath</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">outPath</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p>Also need to set the name of the hydra’s exe file</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hydraVersion</span> <span class="op">&lt;-</span> <span class="st">"hydra_sim"</span></code></pre></div>
</div>
<div id="simulation-darwinian-study" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-darwinian-study" class="anchor"></a>Simulation (Darwinian) study</h2>
<p>Methods used in the simulation study can be found <a href="simulation_documentation.html">here</a>. The code below should be included in a loop to simulate multiple parameter sets</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">ipass</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">simulationRules</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="va"><a href="../reference/darwinRules.html">darwinRules</a></span>
  <span class="va">darwinD</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="va"><a href="../reference/darwinData.html">darwinData</a></span>

  <span class="co"># simulate a set of parameters</span>
  <span class="va">simulatedValues</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_parameters.html">simulate_parameters</a></span><span class="op">(</span><span class="va">darwinD</span>,<span class="va">simulationRules</span>,SRFunctionChoice <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  <span class="co"># combine with extended time series data for darwinian use</span>
  <span class="va">hydraD</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/update_hydra_data.html">update_hydra_data</a></span><span class="op">(</span><span class="fu">hydradata</span><span class="fu">::</span><span class="va">hydraDataList</span>,<span class="va">simulatedValues</span><span class="op">)</span> <span class="co"># update with simulated values</span>
  <span class="va">hydraD</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/update_hydra_data.html">update_hydra_data</a></span><span class="op">(</span><span class="fu">hydradata</span><span class="fu">::</span><span class="va">hydraDataList</span>,<span class="va">noFishingData</span><span class="op">)</span> <span class="co"># update with simulated values</span>
  <span class="co"># create dat and pin files</span>
  <span class="va">inputOptions</span> <span class="op">&lt;-</span> <span class="fu">hydradata</span><span class="fu">::</span><span class="fu">setup_default_inputs</span><span class="op">(</span>outDir<span class="op">=</span><span class="va">outDirForDatPin</span><span class="op">)</span> <span class="co"># gets options for hydraRuns</span>
  <span class="va">inputOptions</span><span class="op">$</span><span class="va">scenarioFlag</span> <span class="op">&lt;-</span> <span class="st">"darwin"</span>
  <span class="va">hydraD</span><span class="op">$</span><span class="va">flagMSE</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># reduces output from hydra run</span>
  <span class="va">hydraD</span><span class="op">$</span><span class="va">recStochastic</span> <span class="op">&lt;-</span> <span class="va">hydraD</span><span class="op">$</span><span class="va">recStochastic</span><span class="op">*</span><span class="fl">0</span> <span class="co"># no stochasticity used in model run</span>
  <span class="va">hydraD</span> <span class="op">&lt;-</span> <span class="fu">hydradata</span><span class="fu">::</span><span class="fu">create_datpin_files</span><span class="op">(</span><span class="va">inputOptions</span>,<span class="va">hydraD</span><span class="op">)</span> <span class="co"># creates dat and pin file</span>
  
  <span class="co"># run hydra </span>
  <span class="co">#specify the path the input files and the Hydra model executable</span>
  <span class="va">datPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outDirForDatPin</span>,<span class="st">"/"</span>,<span class="va">inputOptions</span><span class="op">$</span><span class="va">outputFilename</span>,<span class="st">".dat"</span><span class="op">)</span>
  <span class="va">pinPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outDirForDatPin</span>,<span class="st">"/"</span>,<span class="va">inputOptions</span><span class="op">$</span><span class="va">outputFilename</span>,<span class="st">".pin"</span><span class="op">)</span>
  <span class="va">exePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">pathToTPL</span>,<span class="va">hydraVersion</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span>
  <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/run_single_hydra.html">run_single_hydra</a></span><span class="op">(</span>iseed<span class="op">=</span><span class="fl">1</span>,exePath<span class="op">=</span><span class="va">exePath</span>,datPath<span class="op">=</span><span class="va">datPath</span>,pinPath<span class="op">=</span><span class="va">pinPath</span><span class="op">)</span>

  <span class="co"># move output file</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">'sysname'</span><span class="op">]</span><span class="op">==</span><span class="st">"Windows"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/system.html">shell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"move *.text "</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outDirForDatPin</span>,<span class="st">"/"</span><span class="op">)</span><span class="op">)</span>,intern<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="co"># move files to darwin folder</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">'sysname'</span><span class="op">]</span><span class="op">==</span><span class="st">"Linux"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"mv *.text "</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outDirForDatPin</span>,<span class="st">"/"</span><span class="op">)</span><span class="op">)</span>,intern<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="co"># move files to darwin folder</span>
  <span class="op">}</span></code></pre></div>
</div>
<div id="assess-the-validity-of-the-parameter-set" class="section level2">
<h2 class="hasAnchor">
<a href="#assess-the-validity-of-the-parameter-set" class="anchor"></a>Assess the validity of the parameter set</h2>
<p>Once the mode has run, the output needs to be processed and compared to historic data. If tests are passes this realization is saved for use in an MSE</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># processes output from model (1 file)</span>
  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/process_darwin_output.html">process_darwin_output</a></span><span class="op">(</span><span class="va">outDirForDatPin</span><span class="op">)</span>
  <span class="va">biomass</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">biomass</span>
  <span class="va">catch</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">catch</span>
  <span class="co"># Do these simulations satisfy the rules(historical equivalence)</span>
  <span class="co"># No Fishing Biomass Rule. assumes equilibrium is reached</span>
  <span class="va">rule1</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/rule1_biomass.html">rule1_biomass</a></span><span class="op">(</span><span class="va">biomass</span>,<span class="va">nYrsFishing</span>,<span class="va">stockRecruitData</span><span class="op">$</span><span class="va">historicBounds</span>,<span class="va">simulationRules</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">rule1</span><span class="op">$</span><span class="va">pass</span> <span class="op">==</span> <span class="cn">F</span><span class="op">)</span> <span class="op">{</span> <span class="kw">next</span><span class="op">}</span>
  <span class="co">#  Fishing Biomass Rule. use mean of last 10 years</span>
  <span class="va">rule2</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/rule2_biomass.html">rule2_biomass</a></span><span class="op">(</span><span class="va">biomass</span>,<span class="va">nYrs</span>,<span class="va">stockRecruitData</span><span class="op">$</span><span class="va">historicBounds</span>,<span class="va">simulationRules</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">rule2</span><span class="op">$</span><span class="va">pass</span> <span class="op">==</span> <span class="cn">F</span><span class="op">)</span> <span class="op">{</span> <span class="kw">next</span><span class="op">}</span>
  <span class="co"># Catch Rule</span>
  <span class="va">rule3</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/rule3_landings.html">rule3_landings</a></span><span class="op">(</span><span class="va">catch</span>,<span class="va">nYrs</span>,<span class="va">stockRecruitData</span><span class="op">$</span><span class="va">historicBounds</span>,<span class="va">simulationRules</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">rule3</span><span class="op">$</span><span class="va">pass</span> <span class="op">==</span> <span class="cn">F</span><span class="op">)</span> <span class="op">{</span> <span class="kw">next</span><span class="op">}</span>
  
  <span class="va">ipass</span> <span class="op">&lt;-</span> <span class="va">ipass</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="co"># save all data to RDA file for use in MSE</span>
  <span class="va">darwinRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hydraDarwin<span class="op">=</span><span class="va">hydraD</span>,simulatedValues<span class="op">=</span><span class="va">simulatedValues</span>,simulationRules<span class="op">=</span><span class="va">simulationRules</span>,inputOptions<span class="op">=</span><span class="va">inputOptions</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">darwinRes</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outPath</span>,<span class="st">"/success"</span>,<span class="va">ipass</span>,<span class="st">".RDS"</span><span class="op">)</span><span class="op">)</span>
  
  </code></pre></div>
</div>
<div id="define-scenarios-for-mse" class="section level2">
<h2 class="hasAnchor">
<a href="#define-scenarios-for-mse" class="anchor"></a>Define Scenarios for MSE</h2>
<p>Each parameter set that passes the tests are then used in an MSE type study. Details of which can be found in a the publication (Beet &amp; Fogarty, 2020). The parameter set can be read from .Rda file or passed straight from the darwin study. Here we assume it is read from the rda file. This simulated data set is used to create all o fthe dat an dpin files required for each scenario/ exploitation rate combination</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rootFolder</span> <span class="op">&lt;-</span> <span class="st">"define_the_folder_where_output_for_all_scenario_runs_be_stored"</span>
<span class="va">darwinRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">outPath</span>,<span class="st">"/success1.RDS"</span><span class="op">)</span><span class="op">)</span> <span class="co"># read in the RDS</span>
<span class="va">dataToUse</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/update_hydra_data.html">update_hydra_data</a></span><span class="op">(</span><span class="fu">hydradata</span><span class="fu">::</span><span class="va">hydraDataList</span>,<span class="va">darwinRes</span><span class="op">$</span><span class="va">simulatedValues</span><span class="op">)</span><span class="co"># sets the simulated values to the hydra model data</span>
<span class="va">hcrTypes</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Fixed"</span>,<span class="st">"Ramp"</span><span class="op">)</span> <span class="co"># harvest control rules types</span>
<span class="va">hcrLevels</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Complex"</span>,<span class="st">"HTSpecies"</span>,<span class="st">"LTSpecies"</span><span class="op">)</span> <span class="co">#harvest control rule levels</span>
<span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">hcrTypes</span>,<span class="va">hcrLevels</span><span class="op">)</span>,<span class="fl">1</span>,<span class="va">paste</span>,collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="co"># Create harvest control rule levels</span>
<span class="va">dataToUse</span> <span class="op">&lt;-</span> <span class="fu">hydradata</span><span class="fu">::</span><span class="fu">set_hcr</span><span class="op">(</span><span class="va">dataToUse</span>,minMaxExploitations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.05</span>,<span class="fl">0.4</span><span class="op">)</span>,increment<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>
<span class="va">dataToUse</span><span class="op">$</span><span class="va">flagMSE</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">exploitationRates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">dataToUse</span><span class="op">$</span><span class="va">exploitationOptions</span><span class="op">[</span><span class="va">dataToUse</span><span class="op">$</span><span class="va">Nthresholds</span>,<span class="op">]</span><span class="op">)</span>
<span class="co"># create folder structure for run (given exploitation rates). This creates folders in users working directory</span>
<span class="va">folderStructure</span> <span class="op">&lt;-</span> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/create_folder_setup.html">create_folder_setup</a></span><span class="op">(</span><span class="va">rootFolder</span>,exploitationRates <span class="op">=</span> <span class="va">exploitationRates</span><span class="op">)</span>
<span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">folderStructure</span>,select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hcrType"</span>,<span class="st">"hcrLevels"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">x</span>,collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">folderDirs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">folderStructure</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">x</span>,collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="co"># vector of dirs</span>
<span class="va">outputScenarioDirs</span> <span class="op">&lt;-</span>  <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">rootFolder</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exploitation"</span>,<span class="va">folderDirs</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">iscenario</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">outputScenarioDirs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">outputScenarioDir</span> <span class="op">&lt;-</span> <span class="va">outputScenarioDirs</span><span class="op">[</span><span class="va">iscenario</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">outputScenarioDir</span><span class="op">)</span>
  <span class="co"># set up scenario types to run</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"LT"</span>,<span class="va">folderStructure</span><span class="op">$</span><span class="va">hcrLevels</span><span class="op">[</span><span class="va">iscenario</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="va">speciesFlag</span> <span class="op">&lt;-</span> <span class="st">"low"</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"HT"</span>,<span class="va">folderStructure</span><span class="op">$</span><span class="va">hcrLevels</span><span class="op">[</span><span class="va">iscenario</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="va">speciesFlag</span> <span class="op">&lt;-</span> <span class="st">"high"</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"omplex"</span>,<span class="va">folderStructure</span><span class="op">$</span><span class="va">hcrLevels</span><span class="op">[</span><span class="va">iscenario</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="va">speciesFlag</span> <span class="op">&lt;-</span> <span class="st">"none"</span>
  <span class="va">scenarioInputs</span> <span class="op">&lt;-</span> <span class="fu">hydradata</span><span class="fu">::</span><span class="fu">setup_default_inputs</span><span class="op">(</span>outDir<span class="op">=</span><span class="va">outputScenarioDir</span>,scenarioFlag<span class="op">=</span><span class="st">"assessment"</span>,temperatureFlag<span class="op">=</span><span class="st">"mean"</span>,
                                                    scenarioType<span class="op">=</span><span class="va">folderStructure</span><span class="op">$</span><span class="va">hcrType</span><span class="op">[</span><span class="va">iscenario</span><span class="op">]</span>,maxExploitationRate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">folderStructure</span><span class="op">$</span><span class="va">exploitationRate</span><span class="op">[</span><span class="va">iscenario</span><span class="op">]</span><span class="op">)</span>,
                                                    assessmentSpeciesFlag<span class="op">=</span><span class="va">speciesFlag</span><span class="op">)</span>

  <span class="co"># create dat and pin files for scenario</span>
  <span class="va">dataToPrint</span> <span class="op">&lt;-</span> <span class="fu">hydradata</span><span class="fu">::</span><span class="fu">create_datpin_files</span><span class="op">(</span>listOfParameters<span class="op">=</span><span class="va">scenarioInputs</span>, dataList<span class="op">=</span><span class="va">dataToUse</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="run-the-hydra-model-for-each-scenario" class="section level2">
<h2 class="hasAnchor">
<a href="#run-the-hydra-model-for-each-scenario" class="anchor"></a>Run the hydra model for each scenario</h2>
<p>Once the folder structure has been created and the dat and pin files saved into each scenarios respective folder then the model can be run any nimber of times for each scenario. The model can be run in series or in parallel. This is dependent on the number of cores available on your machine or server</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">   <span class="co">#nCores &lt;- parallel::detectCores()-1</span>
   <span class="co">#cl &lt;- parallel::makeCluster(nCores)</span>

   <span class="va">nSims</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># set number of simulation for each scenario</span>
   <span class="va">exePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">pathToTPL</span>,<span class="va">hydraVersion</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">iscenario</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">folderStructure</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">datpinPath</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">rootFolder</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exploitation"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">folderStructure</span><span class="op">[</span><span class="va">iscenario</span>,<span class="op">]</span>,collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="va">datPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datpinPath</span>,<span class="st">"/"</span>,<span class="va">hydraVersion</span>,<span class="st">".dat"</span><span class="op">)</span>
    <span class="va">pinPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datpinPath</span>,<span class="st">"/"</span>,<span class="va">hydraVersion</span>,<span class="st">".pin"</span><span class="op">)</span>
    <span class="co">#parallel::parLapply(cl,1:nSims,hydramse::run_single_hydra,exePath=exePath,datPath=datPath,pinPath=pinPath)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nSims</span>,<span class="fu">hydramse</span><span class="fu">::</span><span class="va"><a href="../reference/run_single_hydra.html">run_single_hydra</a></span>,exePath<span class="op">=</span><span class="va">exePath</span>,datPath<span class="op">=</span><span class="va">datPath</span>,pinPath<span class="op">=</span><span class="va">pinPath</span><span class="op">)</span>
    <span class="co"># move files</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">'sysname'</span><span class="op">]</span><span class="op">==</span><span class="st">"Windows"</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/system.html">shell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"move *.txt "</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datpinPath</span>,<span class="st">"/indices"</span><span class="op">)</span><span class="op">)</span>,intern<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="co"># move files to assessment folder</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">'sysname'</span><span class="op">]</span><span class="op">==</span><span class="st">"Linux"</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"mv *.txt "</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datpinPath</span>,<span class="st">"/indices"</span><span class="op">)</span><span class="op">)</span>,intern<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="co"># move files to assessment folder</span>
    <span class="op">}</span>
  <span class="op">}</span>
   <span class="co">#parallel::stopCluster(cl)</span></code></pre></div>
</div>
<div id="process-the-output" class="section level2">
<h2 class="hasAnchor">
<a href="#process-the-output" class="anchor"></a>Process the output</h2>
<p>nSim files are created for each scenario run and are stored in the “indices” folder under each scenario. These files are processed for all scenarios and exported to RDS files for plotting. The output files from Hydra contain only the variables listed in the variable “indices” below. This speeds up run time. If indices from outside the model are to be included then they need to be read in and passed to process_model_runs()</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"index_LFI_Catch"</span>,<span class="st">"index_LFI_Biomass"</span>,<span class="st">"index_stdev_catch"</span>,<span class="st">"avByr"</span>,<span class="st">"est_catch_biomass"</span>,<span class="st">"index_status_species"</span>,<span class="st">"index_status_guild"</span><span class="op">)</span>
<span class="va">rD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"revenuePricePerPound2012.csv"</span>,header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">otherData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">otherData</span><span class="op">$</span><span class="va">name</span> <span class="op">=</span> <span class="va">rD</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">otherData</span><span class="op">$</span><span class="va">ppp</span> <span class="op">=</span> <span class="va">rD</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/process_model_runs.html">process_model_runs</a></span><span class="op">(</span><span class="va">dataToUse</span>,<span class="va">indices</span>,<span class="va">scenarios</span>,<span class="va">rootFolder</span>,<span class="va">outputScenarioDirs</span>,<span class="va">otherData</span>,outputType<span class="op">=</span><span class="st">"indices"</span><span class="op">)</span></code></pre></div>
</div>
<div id="plotting-the-output" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-the-output" class="anchor"></a>Plotting the output</h2>
<p>For each of the harvest control rule type/level combinations: 1. A series of boxplots are made to compare biomass, catch, and species/guild status against exploitation rate. 1. Equivalent Line plots are also made 1. Production function plots are also made for each guild 1. Radar plots are made to compare the performace of each oth the indices</p>
<p>Still in Development</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu">hydramse</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_box_whiskers.html">plot_box_whiskers</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">rootFolder</span>,inputFile<span class="op">=</span><span class="st">"species_bio_rate.rds"</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andy Beet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
